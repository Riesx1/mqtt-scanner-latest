# MQTT Security Scanner System - Introduction & Documentation

## 1. System Overview

The **MQTT Security Scanner** is a comprehensive DevSecOps tool designed to discover, analyze, and monitor MQTT brokers and IoT devices within a network. It combines a powerful Python-based scanning engine with a user-friendly Laravel dashboard to provide real-time security insights.

This system is specifically built to identify security vulnerabilities in IoT networks, such as:

-   Unsecured MQTT brokers (No authentication).
-   Lack of encryption (Plaintext communication).
-   Exposed sensitive sensor data.

---

## 2. System Architecture

The system follows a modular 3-tier architecture:

### **Tier 1: The Frontend (Dashboard)**

-   **Technology:** Laravel 10 (PHP) + Tailwind CSS + JavaScript.
-   **Role:** The user interface where you control the scanner and view results.
-   **Key Features:**
    -   **Real-time Monitoring:** Live updates of scan progress.
    -   **Visual Reports:** Summary cards for Total Scanned, Open Brokers, and Auth Failures.
    -   **Data Visualization:** Displays live sensor readings (Temperature, Humidity, Motion, Light).
    -   **Reporting:** Generates professional PDF and CSV reports with unique timestamps.
    -   **Time Sync:** Automatically syncs with Malaysia Time (UTC+8).

### **Tier 2: The Backend (Scanner Engine)**

-   **Technology:** Python (Flask API) + Paho-MQTT Library.
-   **Role:** The "brain" that performs the actual network operations.
-   **Key Functions:**
    -   **Port Scanning:** Checks for open MQTT ports (1883, 8883).
    -   **Protocol Analysis:** Determines if a broker is using TLS/SSL or Plaintext.
    -   **Traffic Sniffing:** Subscribes to topics (e.g., `sensors/#`) to capture live data payloads.
    -   **Vulnerability Assessment:** Tests for anonymous access and weak configurations.

### **Tier 3: The Infrastructure (Brokers & Devices)**

-   **Technology:** Docker (Mosquitto Brokers) + ESP32 Microcontrollers.
-   **Role:** Simulates a real-world IoT environment for testing.
-   **Components:**
    -   **Insecure Broker (Port 1883):** Simulates a vulnerable target (No Auth, No TLS).
    -   **Secure Broker (Port 8883):** Simulates a hardened target (TLS + Password Auth).
    -   **ESP32 Sensors:** Physical or simulated devices publishing real-time environmental data.

---

## 3. How It Works (The Workflow)

1.  **User Input:** You enter a Target IP (e.g., `192.168.100.56`) in the Dashboard.
2.  **Command Dispatch:** Laravel sends a request to the Python Scanner API.
3.  **Network Scan:**
    -   The Python engine attempts to connect to ports 1883 and 8883 on the target.
    -   It checks if the connection requires a password.
    -   It inspects the SSL certificate (if available).
4.  **Data Capture:**
    -   If connected, the scanner subscribes to wildcard topics (`#`).
    -   It captures any messages being published (e.g., `{"temp": 25.5}`).
5.  **Result Processing:** The scanner packages the findings (Security Status, Risk Level, Sensor Data) and sends them back to the Dashboard.
6.  **Display & Report:** The Dashboard updates the UI and allows you to download the findings as a PDF or CSV file.

---

## 4. Key Features & Capabilities

### üõ°Ô∏è Security Analysis

-   **Authentication Check:** Detects if a broker allows anonymous login.
-   **Encryption Check:** Verifies if TLS/SSL is enabled to prevent eavesdropping.
-   **Risk Classification:** Automatically categorizes brokers as **CRITICAL** (No TLS), **MEDIUM** (Auth Failed), or **OK** (Secure).

### üìä Reporting

-   **PDF Reports:** Generates a detailed document with an Executive Summary, Scan Overview, and Detailed Findings for each device.
-   **CSV Exports:** Provides raw data for further analysis in Excel.
-   **Unique Naming:** Files are saved with sequential numbering (e.g., `mqtt_scan_report_001.pdf`) for easy organization.

### üåç Localization

-   **Time Zone:** The system is hardcoded to **Asia/Kuala_Lumpur (UTC+8)** to ensure all logs and reports reflect local time accurately.

---

## 5. Real-World Output Examples

The following examples demonstrate actual results generated by the system during a live scan of an ESP32 device running mixed security protocols.

### üìÑ PDF Report Output

**Executive Summary:**

-   **Total Sensors Detected:** 3
-   **Open Brokers:** 3
-   **Ports Scanned:** 2 (Note: Multiple sensors can share the same port)

**Scan Overview Table:**
| Target | Security | Sensor Type | Latest Reading | Status |
| :--- | :--- | :--- | :--- | :--- |
| `192.168.100.56:1883` | Plain | PIR (Motion Sensor) | Motion | Open / OK |
| `192.168.100.56:8883` | TLS | DHT (Temp & Hum) | 31.5¬∞C, 56% | Open / OK |
| `192.168.100.56:8883` | TLS | LDR (Light Sensor) | 62.1% light | Open / OK |

### üìä CSV Data Export

The system exports raw data in a structured CSV format for analysis:

```csv
Scan Date,Target IP,Port,Protocol,Topic,Sensor Type,Sensor Data (Summary),Raw Payload,Status,Risk Level,Message Count
"12/9/2025, 1:22:13 AM","192.168.100.56","1883","MQTT (Plain)","sensors/faris/pir_insecure","PIR (Motion Sensor)","Motion","{""pir"":1}", "Open / OK","CRITICAL","1"
"12/9/2025, 1:22:13 AM","192.168.100.56","8883","MQTT over TLS","sensors/faris/dht_secure","DHT (Temp & Hum)","31.5C; 56%","{""temp_c"":31.5,""hum_pct"":56.0}", "Open / OK","LOW","1"
```

---

## 6. Getting Started

### Prerequisites

-   Docker Desktop (for Brokers)
-   Python 3.x (for Scanner)
-   PHP & Composer (for Dashboard)

### Running the System

1.  **Start Brokers:** `docker-compose up -d` (in `mqtt-brokers/`)
2.  **Start Scanner:** `python app.py` (in `mqtt-scanner/`)
3.  **Start Dashboard:** `php artisan serve` (in root folder)
4.  **Access:** Open `http://127.0.0.1:8000/dashboard`

---

## 7. Troubleshooting

-   **"Stale Data":** If you see results even when devices are off, run `python clear_retained.py` in the `mqtt-scanner` folder to wipe the broker's memory.
-   **Connection Refused:** Ensure Docker containers are running (`docker-compose ps`).
